<!DOCTYPE html>
<html>
<head>
  <title>WSRP Check-In Test</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2em; }
    .spinner {
      margin: 20px auto;
      width: 40px;
      height: 40px;
      border: 5px solid #ccc;
      border-top-color: #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h2>Check-In to WSRP</h2>
  <p id="status">Click OK to check location and submit.</p>
  <div class="spinner" id="spinner" style="display:none;"></div>

  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbwTzllad6I0TkaIPRb0Thju5f3JeR5eAp7_xoXeoAXHdKyYnQ8DPbBr-AJjpMrXJTn5/exec';
    const uid = 'UID-' + Math.random().toString(36).substring(2, 10);

    function submitCheckIn(uid, latitude, longitude) {
      const formData = new FormData();
      formData.append('uid', uid);
      formData.append('latitude', latitude);
      formData.append('longitude', longitude);

      fetch(webAppUrl, {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(result => {
        document.getElementById('spinner').style.display = 'none';
        document.getElementById('status').innerHTML = result;
      })
      .catch(err => {
        document.getElementById('spinner').style.display = 'none';
        document.getElementById('status').textContent = '❌ Error: ' + err.message;
      });
    }

    function getLocationAndSubmit() {
      document.getElementById('spinner').style.display = 'block';
      if (!navigator.geolocation) {
        document.getElementById('status').textContent = 'Geolocation not supported.';
        return;
      }

      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude.toFixed(6);
          const lng = position.coords.longitude.toFixed(6);
          submitCheckIn(uid, lat, lng);
        },
        error => {
          document.getElementById('spinner').style.display = 'none';
          document.getElementById('status').textContent = '❌ Location error: ' + error.message;
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    }

    document.addEventListener('DOMContentLoaded', getLocationAndSubmit);
  </script>
</body>
</html>
